//variables
def network='jenkins-${BUILD_NUMBER}'
def seleniumHub='selenium-hub-${BUILD_NUMBER}'
def chrome='chrome-${BUILD_NUMBER}'
def firefox='firefox-${BUILD_NUMBER}'
def containertest='conatinertest-${BUILD_NUMBER}'
def mvn_version = 'M3'
pipeline {

   agent any

   stages{
      stage('Build') {
         steps{
          withEnv( ["PATH+MAVEN=${tool mvn_version}/bin"] ) {
             sh "mvn clean"
          }
        }
      }


      stage('Run Test') {
         steps{
         script{
               try{
                        withEnv( ["PATH+MAVEN=${tool mvn_version}/bin"] ) {
                        sh "mvn test -DtestngFile=testng.xml"
                     }
                     } catch (err) {
                            echo err
                           }
                    }
                     echo currentBuild.result
                 }
         }
       }

         post {
        always {
            echo 'I will always say Hello again!'

            emailext (to:'ahmet.turkyilmaz@optiim.com', body: "${currentBuild.currentResult}: Job ${env.JOB_NAME} build ${env.BUILD_NUMBER}\n More info at: ${env.BUILD_URL}",
                recipientProviders: [[$class: 'DevelopersRecipientProvider'], [$class: 'RequesterRecipientProvider']],
                subject: "Jenkins Build ${currentBuild.currentResult}: Job ${env.JOB_NAME}")

        }
   }
}
